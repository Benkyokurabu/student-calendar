<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>スケジュール表</title>

<style>
body{
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  margin:24px;
  background:#f5f7fb;
  color:#111827;
}
.card{
  background:#fff;
  border-radius:12px;
  padding:16px 20px;
  margin-bottom:16px;
  box-shadow:0 2px 10px rgba(0,0,0,0.06);
}
h1{margin:0;font-size:18px;}
h2{margin:0;font-size:15px;}

.muted{color:#6b7280;font-size:13px;}

.cal-head{
  display:flex;
  align-items:flex-end;
  justify-content:space-between;
  gap:12px;
  flex-wrap:wrap;
  margin-bottom:10px;
}
.cal-head-note{
  margin-left:auto;
  text-align:right;
  line-height:1.4;
  max-width:520px;
}

.dow{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:8px;
  font-size:12px;
  color:#6b7280;
  padding:0 2px;
}
.dow div{text-align:center;}
.dow .sun{color:#b91c1c;font-weight:700;}
.dow .sat{color:#1d4ed8;font-weight:700;}

.grid{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:8px;
}
.cell{
  background:#fff;
  border:1px solid #e5e7eb;
  border-radius:12px;
  min-height:95px;
  padding:8px;
  cursor:pointer;
}
.cell.off{
  background:#f8fafc;
  color:#94a3b8;
  cursor:default;
}
.cell.selected{
  border-color:#2563eb;
  background:#eff6ff;
}
.date-row{
  display:flex;
  justify-content:space-between;
  margin-bottom:6px;
}
.date-num{font-weight:800;font-size:13px;}
.badge{
  font-size:11px;
  padding:2px 8px;
  border-radius:999px;
  background:#eef2ff;
  color:#3730a3;
}

.lesson{
  font-size:12px;
  margin-bottom:4px;
}

table{
  width:100%;
  border-collapse:collapse;
  font-size:14px;
}
th,td{
  padding:8px 6px;
  border-bottom:1px solid #e5e7eb;
}
th{
  text-align:left;
  background:#f9fafb;
}
</style>
</head>

<body>

<div class="card">
  <h1>スケジュール表 <span id="ymLabel"></span></h1>
</div>

<div class="card">
  <div class="cal-head">
    <h2>月間カレンダー</h2>
    <div class="cal-head-note muted">
      ※ 日付をクリックすると、その日の授業（詳細）が下に表示されます。
    </div>
  </div>

  <div class="dow">
    <div class="sun">日</div>
    <div>月</div>
    <div>火</div>
    <div>水</div>
    <div>木</div>
    <div>金</div>
    <div class="sat">土</div>
  </div>

  <div id="monthGrid" class="grid"></div>
</div>

<div id="detailArea"></div>

<script>
const today = new Date();
let currentYM = today.getFullYear() + "-" + String(today.getMonth()+1).padStart(2,"0");
let selectedDate = null;
let lessons = [];

document.getElementById("ymLabel").textContent =
  today.getFullYear()+"年"+(today.getMonth()+1)+"月";

fetch("schedule_" + currentYM + ".json")
  .then(res => res.json())
  .then(data => {
    lessons = data;
    renderCalendar();
  })
  .catch(()=>renderCalendar());

function renderCalendar(){
  const grid = document.getElementById("monthGrid");
  grid.innerHTML = "";

  const [y,m] = currentYM.split("-").map(Number);
  const first = new Date(y,m-1,1);
  const startDay = first.getDay();
  const days = new Date(y,m,0).getDate();

  for(let i=0;i<42;i++){
    const dayNum = i-startDay+1;
    const div = document.createElement("div");
    div.className="cell";

    if(dayNum<1 || dayNum>days){
      div.classList.add("off");
      grid.appendChild(div);
      continue;
    }

    const dateStr =
      y+"-"+String(m).padStart(2,"0")+"-"+String(dayNum).padStart(2,"0");

    const dayLessons = lessons.filter(l=>l.date===dateStr);

    div.innerHTML =
      '<div class="date-row">' +
      '<span class="date-num">'+dayNum+'</span>' +
      (dayLessons.length?'<span class="badge">'+dayLessons.length+'件</span>':'')+
      '</div>' +
      dayLessons.slice(0,3).map(l=>'<div class="lesson">'+l.time+' '+l.label+'</div>').join("");

    div.addEventListener("click",()=>{
      selectedDate = dateStr;
      renderDetail();
      renderCalendar();
    });

    if(selectedDate===dateStr) div.classList.add("selected");

    grid.appendChild(div);
  }
}

function renderDetail(){
  const area = document.getElementById("detailArea");
  const list = lessons.filter(l=>l.date===selectedDate);

  area.innerHTML =
    '<div class="card">'+
    '<h2>日別詳細：'+selectedDate+'</h2>'+
    (list.length===0?
      '<div class="muted">授業はありません。</div>'
      :
      '<table>'+
      '<tr><th>時間</th><th>授業</th><th>校舎</th><th>教室</th></tr>'+
      list.map(l=>'<tr><td>'+l.time+'</td><td>'+l.label+'</td><td>'+l.campus+'</td><td>'+l.room+'</td></tr>').join("")+
      '</table>'
    )+
    '</div>';
}
</script>

</body>
</html>
